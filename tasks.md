# 剑与远征启程自动化脚本 - Task List

## Implementation Tasks

### 阶段 1: 项目基础搭建

- [ ] **1. 创建项目基础结构**
    - [ ] 1.1. 创建项目目录结构
        - *目标*: 按照设计文档创建完整的项目目录结构
        - *操作*: 创建 src/, tests/, docs/ 等目录及其子目录
        - *需求*: 对应需求 4.1 (模块化架构组织代码)
    
    - [ ] 1.2. 编写项目依赖配置文件
        - *目标*: 创建 requirements.txt 和 requirements-dev.txt
        - *操作*: 添加 PyQt6, opencv-python, pillow, pytesseract, pyyaml 等依赖
        - *需求*: 对应技术约束 (Python, PyQt6)
    
    - [ ] 1.3. 实现日志服务基础模块
        - *目标*: 创建 src/services/log_service.py
        - *操作*: 实现 setup_logger 函数，配置文件和控制台日志处理器
        - *需求*: 对应需求 3.3 (实时日志显示)

### 阶段 2: 数据模型和异常处理

- [ ] **2. 实现核心数据模型**
    - [ ] 2.1. 创建设备信息模型
        - *目标*: 创建 src/models/device.py
        - *操作*: 实现 Device 数据类，包含设备ID、名称、型号等属性
        - *需求*: 对应需求 1.1, 1.2 (设备检测和管理)
    
    - [ ] 2.2. 创建配置数据模型
        - *目标*: 创建 src/models/config.py
        - *操作*: 实现 ADBConfig, GameConfig, AppConfig 数据类
        - *需求*: 对应需求 3.5 (配置保存和加载)
    
    - [ ] 2.3. 创建任务状态模型
        - *目标*: 创建 src/models/task.py
        - *操作*: 实现 TaskStatus 枚举和 TaskInfo 数据类
        - *需求*: 对应需求 4.2, 4.3 (任务管理)

- [ ] **3. 实现异常处理机制**
    - [ ] 3.1. 创建自定义异常类
        - *目标*: 创建 src/utils/exceptions.py
        - *操作*: 定义 AFK2AutoException 基类及各种业务异常类
        - *需求*: 对应非功能性需求 (可靠性要求)
    
    - [ ] 3.2. 实现重试装饰器
        - *目标*: 创建 src/utils/retry.py
        - *操作*: 实现 RetryDecorator 类，支持可配置的重试机制
        - *需求*: 对应需求 4.5 (任务失败重试机制)

### 阶段 3: ADB服务层实现

- [ ] **4. 实现ADB服务核心功能**
    - [ ] 4.1. 创建ADB服务基础类
        - *目标*: 创建 src/services/adb_service.py
        - *操作*: 实现 ADBService 类的基础结构和初始化方法
        - *需求*: 对应需求 1.1 (自动检测ADB设备)
    
    - [ ] 4.2. 实现设备连接管理功能
        - *目标*: 在 ADBService 中实现设备连接相关方法
        - *操作*: 实现 connect_device, disconnect_device, get_devices 方法
        - *需求*: 对应需求 1.1, 1.2, 1.3 (设备连接管理)
    
    - [ ] 4.3. 实现ADB命令执行功能
        - *目标*: 在 ADBService 中实现命令执行方法
        - *操作*: 实现 execute_command 方法，支持超时和错误处理
        - *需求*: 对应需求 1.4 (连接失败错误信息)
    
    - [ ] 4.4. 实现应用控制功能
        - *目标*: 在 ADBService 中实现应用启动和停止
        - *操作*: 实现 start_app, stop_app 方法
        - *需求*: 对应需求 2.1, 2.2 (启动剑与远征启程应用)
    
    - [ ] 4.5. 实现设备操作功能
        - *目标*: 在 ADBService 中实现触摸和滑动操作
        - *操作*: 实现 tap, swipe, screenshot, unlock_screen 方法
        - *需求*: 对应需求 2.3, 5.1 (设备操作封装)
    
    - [ ] 4.6. 编写ADB服务单元测试
        - *目标*: 创建 tests/unit/test_adb_service.py
        - *操作*: 使用 pytest 和 mock 测试所有 ADB 服务方法
        - *需求*: 对应测试策略 (单元测试)

### 阶段 4: 配置管理服务

- [ ] **5. 实现配置服务**
    - [ ] 5.1. 创建配置服务类
        - *目标*: 创建 src/services/config_service.py
        - *操作*: 实现 ConfigService 类，支持 JSON/YAML 格式
        - *需求*: 对应需求 3.5 (配置保存和加载)
    
    - [ ] 5.2. 实现配置文件读写功能
        - *目标*: 实现配置的加载、保存和验证
        - *操作*: 实现 load_config, save_config, validate_config 方法
        - *需求*: 对应非功能性需求 (配置文件自动备份)
    
    - [ ] 5.3. 编写配置服务单元测试
        - *目标*: 创建 tests/unit/test_config_service.py
        - *操作*: 测试配置文件的读写和验证功能
        - *需求*: 对应测试策略 (配置文件读写测试)

### 阶段 5: 图像识别和OCR模块

- [ ] **6. 实现图像识别功能**
    - [ ] 6.1. 创建图像识别器类
        - *目标*: 创建 src/recognition/image_recognizer.py
        - *操作*: 实现 ImageRecognizer 类，使用 OpenCV 进行模板匹配
        - *需求*: 对应需求 5.4 (图片识别)
    
    - [ ] 6.2. 实现图像查找功能
        - *目标*: 实现图像匹配和查找方法
        - *操作*: 实现 find_image, find_all_images, wait_for_image 方法
        - *需求*: 对应需求 5.4 (图片识别功能)
    
    - [ ] 6.3. 编写图像识别单元测试
        - *目标*: 创建 tests/unit/test_image_recognizer.py
        - *操作*: 使用测试图像验证识别准确性
        - *需求*: 对应测试策略 (图像识别算法准确性)

- [ ] **7. 实现OCR识别功能**
    - [ ] 7.1. 创建OCR引擎类
        - *目标*: 创建 src/recognition/ocr_engine.py
        - *操作*: 实现 OCREngine 类，集成 pytesseract 或 PaddleOCR
        - *需求*: 对应需求 5.4 (OCR文字识别)
    
    - [ ] 7.2. 实现文字识别功能
        - *目标*: 实现文字识别和查找方法
        - *操作*: 实现 recognize_text, find_text, get_all_text 方法
        - *需求*: 对应需求 5.4 (OCR文字识别)
    
    - [ ] 7.3. 编写OCR识别单元测试
        - *目标*: 创建 tests/unit/test_ocr_engine.py
        - *操作*: 使用测试图像验证OCR准确率
        - *需求*: 对应测试策略 (OCR识别准确率)

### 阶段 6: 游戏控制器

- [ ] **8. 实现游戏控制器**
    - [ ] 8.1. 创建游戏控制器类
        - *目标*: 创建 src/controllers/game_controller.py
        - *操作*: 实现 GameController 类，整合 ADB 服务和识别模块
        - *需求*: 对应需求 2.1 (唤醒游戏应用)
    
    - [ ] 8.2. 实现游戏唤醒功能
        - *目标*: 实现完整的游戏唤醒流程
        - *操作*: 实现 wake_up_game 方法，包含解锁、启动、等待加载
        - *需求*: 对应需求 2.1, 2.2, 2.3, 2.4 (游戏唤醒完整流程)
    
    - [ ] 8.3. 实现游戏状态检测
        - *目标*: 实现游戏状态识别功能
        - *操作*: 实现 check_game_status 方法，识别当前游戏界面
        - *需求*: 对应需求 2.4 (确认进入主界面)
    
    - [ ] 8.4. 编写游戏控制器集成测试
        - *目标*: 创建 tests/integration/test_game_controller.py
        - *操作*: 测试完整的游戏唤醒流程
        - *需求*: 对应测试策略 (完整游戏唤醒流程测试)

### 阶段 7: 任务管理系统

- [ ] **9. 实现任务管理器**
    - [ ] 9.1. 创建任务基类
        - *目标*: 在 src/controllers/task_manager.py 中创建 Task 抽象基类
        - *操作*: 定义 execute, pause, resume, stop 抽象方法
        - *需求*: 对应需求 4.2 (任务基类)
    
    - [ ] 9.2. 实现任务管理器类
        - *目标*: 实现 TaskManager 类
        - *操作*: 实现任务添加、移除、执行和状态管理功能
        - *需求*: 对应需求 4.3, 4.4 (任务执行和监控)
    
    - [ ] 9.3. 实现唤醒游戏任务
        - *目标*: 创建 WakeUpGameTask 类
        - *操作*: 继承 Task 基类，实现游戏唤醒任务
        - *需求*: 对应需求 2.1, 4.2 (具体任务实现)
    
    - [ ] 9.4. 编写任务管理器单元测试
        - *目标*: 创建 tests/unit/test_task_manager.py
        - *操作*: 测试任务的创建、执行、状态管理
        - *需求*: 对应测试策略 (任务状态管理测试)

### 阶段 8: GUI界面实现

- [ ] **10. 创建主窗口界面**
    - [ ] 10.1. 实现主窗口框架
        - *目标*: 创建 src/gui/main_window.py
        - *操作*: 实现 MainWindow 类，创建基础窗口和菜单栏
        - *需求*: 对应需求 3.1 (主窗口显示)
    
    - [ ] 10.2. 实现标签页容器
        - *目标*: 在主窗口中添加 QTabWidget
        - *操作*: 实现 create_tabs 方法，创建多标签页结构
        - *需求*: 对应需求 3.1, 3.2 (多功能标签页)
    
    - [ ] 10.3. 实现日志查看器
        - *目标*: 创建 src/gui/log_viewer.py
        - *操作*: 实现 LogViewer 组件，实时显示日志
        - *需求*: 对应需求 3.3 (实时日志显示)

- [ ] **11. 实现ADB配置标签页**
    - [ ] 11.1. 创建ADB配置界面
        - *目标*: 创建 src/gui/adb_config_tab.py
        - *操作*: 实现 ADBConfigTab 类，包含设备选择和连接配置
        - *需求*: 对应需求 3.2 (ADB配置标签页)
    
    - [ ] 11.2. 实现设备列表显示
        - *目标*: 添加设备列表和刷新功能
        - *操作*: 使用 QListWidget 显示设备，添加刷新按钮
        - *需求*: 对应需求 1.1, 1.2 (设备检测和选择)
    
    - [ ] 11.3. 实现无线连接配置
        - *目标*: 添加无线ADB连接输入框
        - *操作*: 添加 IP 地址输入框和连接按钮
        - *需求*: 对应需求 1.3 (无线ADB连接)

- [ ] **12. 实现任务控制标签页**
    - [ ] 12.1. 创建任务控制界面
        - *目标*: 创建 src/gui/task_tab.py
        - *操作*: 实现 TaskTab 类，包含任务控制按钮
        - *需求*: 对应需求 3.1 (任务控制页)
    
    - [ ] 12.2. 实现唤醒游戏按钮
        - *目标*: 添加唤醒游戏控制功能
        - *操作*: 创建唤醒按钮，连接到游戏控制器
        - *需求*: 对应需求 2.1 (唤醒应用按钮)
    
    - [ ] 12.3. 实现状态显示
        - *目标*: 添加任务状态和进度显示
        - *操作*: 使用 QLabel 和 QProgressBar 显示状态
        - *需求*: 对应需求 3.4 (视觉反馈)

### 阶段 9: 系统集成

- [ ] **13. 实现主程序入口**
    - [ ] 13.1. 创建主程序文件
        - *目标*: 创建 src/main.py
        - *操作*: 实现应用程序初始化和启动逻辑
        - *需求*: 对应性能要求 (启动时间不超过3秒)
    
    - [ ] 13.2. 更新启动脚本
        - *目标*: 修改 run.py
        - *操作*: 添加启动主程序的代码
        - *需求*: 对应项目结构设计

- [ ] **14. 集成所有模块**
    - [ ] 14.1. 连接GUI与业务逻辑
        - *目标*: 在主窗口中集成所有功能模块
        - *操作*: 连接按钮事件到相应的控制器方法
        - *需求*: 对应需求 3.4 (界面操作反馈)
    
    - [ ] 14.2. 实现配置加载和保存
        - *目标*: 在应用启动和关闭时处理配置
        - *操作*: 集成配置服务到主程序
        - *需求*: 对应需求 3.5 (配置保存和加载)
    
    - [ ] 14.3. 实现错误处理和用户提示
        - *目标*: 添加全局错误处理
        - *操作*: 使用 QMessageBox 显示用户友好的错误信息
        - *需求*: 对应需求 1.4, 2.5 (错误信息和日志)

### 阶段 10: 测试和优化

- [ ] **15. 编写集成测试**
    - [ ] 15.1. 创建端到端测试
        - *目标*: 创建 tests/integration/test_end_to_end.py
        - *操作*: 测试从设备连接到游戏唤醒的完整流程
        - *需求*: 对应测试策略 (集成测试)
    
    - [ ] 15.2. 创建GUI测试
        - *目标*: 创建 tests/unit/test_gui.py
        - *操作*: 使用 pytest-qt 测试界面组件
        - *需求*: 对应测试策略 (GUI测试)
    
    - [ ] 15.3. 创建性能测试
        - *目标*: 创建 tests/performance/test_performance.py
        - *操作*: 测试ADB命令响应时间和截图性能
        - *需求*: 对应性能要求 (响应时间不超过500ms)

- [ ] **16. 优化和完善**
    - [ ] 16.1. 添加异步处理
        - *目标*: 优化长时间操作的用户体验
        - *操作*: 使用 QThread 处理 ADB 操作和图像识别
        - *需求*: 对应设计原则 (异步处理避免界面卡顿)
    
    - [ ] 16.2. 优化错误恢复机制
        - *目标*: 完善重试和错误处理
        - *操作*: 在关键操作中应用重试装饰器
        - *需求*: 对应需求 4.5 (重试机制)
    
    - [ ] 16.3. 添加详细日志记录
        - *目标*: 在所有模块中添加适当的日志
        - *操作*: 使用配置的 logger 记录关键操作
        - *需求*: 对应需求 2.5, 3.3 (操作日志)

## 任务依赖关系

- 阶段 1 必须最先完成（项目基础）
- 阶段 2 依赖阶段 1（需要项目结构）
- 阶段 3 依赖阶段 2（需要数据模型和异常处理）
- 阶段 4 可以与阶段 3 并行开发
- 阶段 5 依赖阶段 1（需要项目结构）
- 阶段 6 依赖阶段 3 和阶段 5（需要 ADB 服务和识别模块）
- 阶段 7 依赖阶段 6（需要游戏控制器）
- 阶段 8 依赖阶段 1 和阶段 2（需要基础结构和数据模型）
- 阶段 9 依赖阶段 3-8（集成所有模块）
- 阶段 10 依赖阶段 9（需要完整系统）

## 预估时间

- 阶段 1: 2 小时
- 阶段 2: 2 小时
- 阶段 3: 6 小时
- 阶段 4: 2 小时
- 阶段 5: 4 小时
- 阶段 6: 4 小时
- 阶段 7: 3 小时
- 阶段 8: 6 小时
- 阶段 9: 3 小时
- 阶段 10: 4 小时
- **总计: 约 36 小时**
